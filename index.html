<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Burpee Logger</title>
  <style>
    :root{
      --bg:#f7f8fb;--panel:#fff;--muted:#6b7280;--text:#0f172a;--primary:#2563eb;--ring:#3b82f6;--danger:#ef4444;
      --green100:#dcfce7;--green200:#bbf7d0;--green300:#86efac;--green400:#4ade80;--gray100:#f3f4f6;
    }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(#f7f8fb,#fff);color:var(--text);font:14px/1.45 system-ui,Segoe UI,Inter,Roboto,Arial}
    .container{max-width:1100px;margin:auto;padding:24px}
    h1{font-size:28px;margin:0 0 6px;font-weight:700}
    p.sub{color:var(--muted);margin:0 0 20px}
    .row{display:grid;gap:16px}
    .row.cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}
    .row.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:820px){.row.cols-5{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:760px){.row.cols-2{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.04)}
    .card .content{padding:16px}
    .btn{appearance:none;border:1px solid #d1d5db;background:#fff;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;transition:.15s}
    .btn:hover{box-shadow:0 2px 8px rgba(0,0,0,.05)}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.ghost{background:transparent;border:none;color:var(--text)}
    .btn.danger{background:var(--danger);border-color:var(--danger);color:#fff}
    .btn.small{padding:4px 8px;border-radius:8px}
    .btn-group{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input[type="date"],input[type="number"],input[type="file"]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;font:inherit}
    input:focus{outline:2px solid var(--ring);outline-offset:1px}
    .stat{display:flex;flex-direction:column;gap:4px}
    .stat .val{font-size:22px;font-weight:700}
    .stat .lbl{font-size:11px;color:var(--muted)}
    .header{display:flex;flex-wrap:wrap;gap:10px;align-items:end;justify-content:space-between;margin-bottom:16px}
    .muted{color:var(--muted)}

    /* Calendar */
    .cal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .cal-wd{font-size:11px;color:var(--muted);text-align:center}
    .cal-cell{border-radius:10px;padding:6px;display:flex;flex-direction:column;gap:4px;align-items:center;justify-content:center;border:1px solid #e5e7eb;background:#fff;transition:.12s}
    .cal-cell.dim{opacity:.45}
    .cal-cell:hover{outline:2px solid var(--ring)}
    .heat{height:30px;width:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;border:1px solid #e5e7eb}
    .heat.level0{background:var(--gray100)}
    .heat.level1{background:var(--green100)}
    .heat.level2{background:var(--green200)}
    .heat.level3{background:var(--green300)}
    .heat.level4{background:var(--green400)}
    .cal-day{font-size:10px;font-weight:600}

    /* Burpee animation card */
    .anim-wrap{display:flex;align-items:center;justify-content:center;min-height:320px;position:relative}
    .legend{position:absolute;right:12px;top:12px;color:var(--muted);font-size:12px}
    .ground{position:absolute;left:20px;right:20px;bottom:30px;height:2px;background:#e5e7eb;border-radius:2px}
    .shadow{position:absolute;bottom:24px;left:50%;transform:translateX(-50%) scale(1);width:120px;height:16px;background:radial-gradient(ellipse at center, rgba(0,0,0,.15), rgba(0,0,0,0) 70%);filter:blur(1px);border-radius:50%}
    .footer{font-size:12px;color:var(--muted);text-align:center;padding-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>Burpee Logger</h1>
        <p class="sub">Log a single <b>daily total</b>, track streaks, and view progress on the calendar. Data stays in your browser.</p>
      </div>
      <div class="btn-group">
        <button id="exportBtn" class="btn">Export</button>
        <label class="btn" for="importFile">Import JSON</label>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
        <button id="clearBtn" class="btn danger">Clear</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="row cols-5">
      <div class="card"><div class="content stat"><div class="val" id="todayVal">0</div><div class="lbl">Today</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="weekVal">0</div><div class="lbl">This Week</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="monthVal">0</div><div class="lbl">This Month</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="yearVal">0</div><div class="lbl">This Year</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="streakVal">0</div><div class="lbl">Streak (days)</div></div></div>
    </div>

    <!-- Entry form -->
    <div class="card" style="margin-top:16px">
      <div class="content">
        <div class="row cols-2" style="align-items:end">
          <div>
            <label for="dateInput">Date</label>
            <input id="dateInput" type="date" />
          </div>
          <div>
            <label for="countInput">Total burpees (for that day)</label>
            <input id="countInput" type="number" min="0" placeholder="e.g., 100" />
            <div class="muted" id="existingForDate" style="font-size:11px;margin-top:4px"></div>
          </div>
        </div>
        <div class="row cols-2" style="margin-top:10px;align-items:center">
          <div>
            <button id="saveBtn" class="btn primary" style="width:100%">Save Daily Total</button>
          </div>
          <div class="btn-group">
            <span class="muted">Quick add to <b>today</b>:</span>
            <button class="btn small" data-qa="10">+10</button>
            <button class="btn small" data-qa="25">+25</button>
            <button class="btn small" data-qa="50">+50</button>
            <button class="btn small" data-qa="100">+100</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendar & Animation -->
    <div class="row cols-2" style="margin-top:16px">
      <div class="card">
        <div class="content">
          <div class="cal-head">
            <button id="prevMonth" class="btn ghost" title="Previous month">◀</button>
            <div><b id="monthTitle">Month YYYY</b></div>
            <button id="nextMonth" class="btn ghost" title="Next month">▶</button>
          </div>
          <div class="cal-grid" id="calGrid"></div>
        </div>
      </div>

      <div class="card">
        <div class="content anim-wrap">
          <div class="legend">Burpee demo</div>
          <div class="ground"></div>
          <div class="shadow" id="shadow"></div>
          <!-- SVG stick figure -->
          <svg id="burpeeSVG" viewBox="0 0 240 240" width="100%" height="300" style="max-width:460px">
            <circle id="head" cx="120" cy="68" r="10" fill="#0f172a" />
            <line id="spine" x1="120" y1="80" x2="120" y2="130" stroke="#0f172a" stroke-width="4" stroke-linecap="round"/>
            <line id="armL" x1="120" y1="95" x2="95"  y2="115" stroke="#0f172a" stroke-width="4" stroke-linecap="round"/>
            <line id="armR" x1="120" y1="95" x2="145" y2="115" stroke="#0f172a" stroke-width="4" stroke-linecap="round"/>
            <line id="legL" x1="120" y1="130" x2="105" y2="165" stroke="#0f172a" stroke-width="4" stroke-linecap="round"/>
            <line id="legR" x1="120" y1="130" x2="135" y2="165" stroke="#0f172a" stroke-width="4" stroke-linecap="round"/>
          </svg>
        </div>
      </div>
    </div>

    <div class="footer">Tip: Click any day in the calendar to edit that date. Your data is stored in Local Storage.</div>
  </div>

  <script>
    // ---------- Utilities ----------
    const LS_KEY = 'burpeesLog.v1';
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const fmtYMD = d => {
      if (typeof d === 'string') return d;
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    };
    const parseYMD = s => { const [y,m,d]=s.split('-').map(Number); return new Date(y, m-1, d); };
    const addDays = (date,n)=>{ const d=new Date(date); d.setDate(d.getDate()+n); return d; };
    const startOfMonth = d=>{ const x=new Date(d.getFullYear(), d.getMonth(), 1); x.setHours(0,0,0,0); return x; };
    const endOfMonth = d=>{ const x=new Date(d.getFullYear(), d.getMonth()+1, 0); x.setHours(0,0,0,0); return x; };
    const startOfWeek = date=>{ const d=new Date(date); const day=(d.getDay()+6)%7; d.setDate(d.getDate()-day); d.setHours(0,0,0,0); return d; };

    // ---------- Storage ----------
    function loadEntries(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return [];
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr)) return [];
        return arr.filter(e=>e && typeof e.date==='string' && Number.isFinite(e.count));
      }catch(e){console.error(e); return []}
    }
    function saveEntries(entries){ localStorage.setItem(LS_KEY, JSON.stringify(entries)); }

    // ---------- State ----------
    let entries = loadEntries();
    let monthDate = new Date();

    function updateExistingHint(){
      const key = $('#dateInput').value;
      const existing = entries.find(e=>e.date===key)?.count || 0;
      const el = $('#existingForDate');
      el.textContent = existing>0 ? `Existing total for this date: ${existing}` : '';
    }

    function upsertEntry(dateKey, total){
      entries = entries.filter(e=>e.date!==dateKey).concat({date:dateKey, count:total}).sort((a,b)=>a.date.localeCompare(b.date));
      saveEntries(entries);
      renderAll();
    }

    function onSave(){
      const dateKey = $('#dateInput').value || fmtYMD(new Date());
      const total = Number($('#countInput').value||0);
      const existing = entries.find(e=>e.date===dateKey)?.count;
      if(existing!=null && existing!==total){
        if(!confirm(`Overwrite existing total of ${existing} for ${dateKey} with ${total}?`)) return;
      }
      upsertEntry(dateKey,total);
    }

    function quickAdd(n){
      const todayKey = fmtYMD(new Date());
      const current = entries.find(e=>e.date===todayKey)?.count || 0;
      const newTotal = current + n;
      upsertEntry(todayKey,newTotal);
      $('#dateInput').value = todayKey; $('#countInput').value = newTotal; updateExistingHint();
    }

    function aggregates(){
      const byDate = new Map();
      for(const e of entries){ byDate.set(e.date, (byDate.get(e.date)||0)+e.count); }
      const now = new Date();
      const todayKey = fmtYMD(now);
      const weekStart = startOfWeek(now);
      const monthStart = startOfMonth(now);
      const yearStart = new Date(now.getFullYear(),0,1);
      let today=0,thisWeek=0,thisMonth=0,thisYear=0,streak=0;
      for(const [d,c] of byDate){
        const dt = parseYMD(d);
        if(d===todayKey) today+=c;
        if(dt>=weekStart) thisWeek+=c;
        if(dt>=monthStart) thisMonth+=c;
        if(dt>=yearStart) thisYear+=c;
      }
      for(let i=0;i<9999;i++){ const key=fmtYMD(addDays(new Date(),-i)); const c=byDate.get(key)||0; if(c>0) streak++; else break; }
      return {today,thisWeek,thisMonth,thisYear,streak,byDate};
    }

    function heatLevel(val){ if(!val) return 0; const t=Math.min(val,200)/200; if(t<=0.25)return 1; if(t<=0.5)return 2; if(t<=0.75)return 3; return 4; }

    function renderCalendar(){
      const {byDate} = aggregates();
      $('#monthTitle').textContent = monthDate.toLocaleString(undefined,{month:'long',year:'numeric'});
      const first = startOfMonth(monthDate), last=endOfMonth(monthDate); const gridStart=startOfWeek(first);
      const grid = $('#calGrid'); grid.innerHTML='';
      ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'].forEach(d=>{ const wd=document.createElement('div'); wd.className='cal-wd'; wd.textContent=d; grid.appendChild(wd); });
      let c=new Date(gridStart); const cells=[];
      while(c<=last || (cells.length%7)!==0){
        const key=fmtYMD(c); const count=(byDate.get(key)||0); const el=document.createElement('button'); el.className='cal-cell'+(c.getMonth()!==monthDate.getMonth()?' dim':''); el.title=`${key}: ${count} burpees`;
        el.addEventListener('click',()=>{ $('#dateInput').value=key; $('#countInput').value=count||''; updateExistingHint(); window.scrollTo({top:0,behavior:'smooth'}); });
        const heat=document.createElement('div'); heat.className='heat level'+heatLevel(count); heat.textContent=count?String(count):''; el.appendChild(heat);
        const day=document.createElement('div'); day.className='cal-day'; day.textContent=String(c.getDate()); el.appendChild(day);
        grid.appendChild(el); cells.push(el); c=addDays(c,1);
      }
    }

    function renderStats(){ const a=aggregates(); $('#todayVal').textContent=a.today; $('#weekVal').textContent=a.thisWeek; $('#monthVal').textContent=a.thisMonth; $('#yearVal').textContent=a.thisYear; $('#streakVal').textContent=a.streak; }

    function renderAll(){ renderStats(); renderCalendar(); }

    // ---------- Export / Import / Clear ----------
    function exportJSON(){ const blob=new Blob([JSON.stringify(entries,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`burpees-log-${Date.now()}.json`; a.click(); URL.revokeObjectURL(url); }
    function onImportFile(e){ const f=e.target.files?.[0]; if(!f) return; const reader=new FileReader(); reader.onload=()=>{ try{ const parsed=JSON.parse(reader.result); if(Array.isArray(parsed)){ const cleaned=parsed.filter(x=>x && typeof x.date==='string' && Number.isFinite(x.count)).map(x=>({date:fmtYMD(parseYMD(x.date)), count:Number(x.count)})).sort((a,b)=>a.date.localeCompare(b.date)); entries=cleaned; saveEntries(entries); renderAll(); } }catch(err){ alert('Import failed: '+err); } }; reader.readAsText(f); e.target.value=''; }
    function clearAll(){ if(confirm('This will delete all logged burpees. Continue?')){ entries=[]; saveEntries(entries); renderAll(); } }

    // ---------- Burpee animation (approximation) ----------
    function animateBurpee(){
      const svg = document.getElementById('burpeeSVG');
      const head=svg.querySelector('#head');
      const spine=svg.querySelector('#spine');
      const armL=svg.querySelector('#armL');
      const armR=svg.querySelector('#armR');
      const legL=svg.querySelector('#legL');
      const legR=svg.querySelector('#legR');
      const shadow=document.getElementById('shadow');

      // Stand → Squat → Plank → Push-down → Plank → Squat-in → Jump/extend → Stand
      const poses=[
        {h:[120,68], s:[120,80,120,130], aL:[120,95,95,115], aR:[120,95,145,115], lL:[120,130,105,165], lR:[120,130,135,165], sh:1.0, t:260},
        {h:[120,90], s:[120,100,120,144], aL:[118,112,106,134], aR:[122,112,134,134], lL:[120,144,112,174], lR:[120,144,128,174], sh:1.05, t:180},
        {h:[145,112], s:[145,122,185,122], aL:[155,122,175,122], aR:[155,122,175,122], lL:[185,122,210,122], lR:[185,122,210,122], sh:0.95, t:200},
        {h:[145,116], s:[145,126,185,126], aL:[155,126,175,126], aR:[155,126,175,126], lL:[185,126,210,126], lR:[185,126,210,126], sh:0.95, t:180},
        {h:[145,112], s:[145,122,185,122], aL:[155,122,175,122], aR:[155,122,175,122], lL:[185,122,210,122], lR:[185,122,210,122], sh:0.95, t:180},
        {h:[120,90], s:[120,100,120,144], aL:[118,112,106,134], aR:[122,112,134,134], lL:[120,144,112,174], lR:[120,144,128,174], sh:1.05, t:180},
        {h:[120,56], s:[120,72,120,122], aL:[120,78,100,50], aR:[120,78,140,50], lL:[120,122,120,158], lR:[120,122,120,158], sh:0.7, t:220},
      ];

      let i=0; let start=null; let from=poses[0]; let to=poses[1];

      function lerp(a,b,t){ return a+(b-a)*t; }
      function mix4(a,b,t){ return [lerp(a[0],b[0],t), lerp(a[1],b[1],t), lerp(a[2],b[2],t), lerp(a[3],b[3],t)]; }
      function mix2(a,b,t){ return [lerp(a[0],b[0],t), lerp(a[1],b[1],t)]; }
      function easeInOut(t){ return t<.5 ? 2*t*t : 1 - Math.pow(-2*t+2,2)/2; }

      function apply(p){
        head.setAttribute('cx', p.h[0]); head.setAttribute('cy', p.h[1]);
        spine.setAttribute('x1', p.s[0]); spine.setAttribute('y1', p.s[1]); spine.setAttribute('x2', p.s[2]); spine.setAttribute('y2', p.s[3]);
        armL.setAttribute('x1', p.aL[0]); armL.setAttribute('y1', p.aL[1]); armL.setAttribute('x2', p.aL[2]); armL.setAttribute('y2', p.aL[3]);
        armR.setAttribute('x1', p.aR[0]); armR.setAttribute('y1', p.aR[1]); armR.setAttribute('x2', p.aR[2]); armR.setAttribute('y2', p.aR[3]);
        legL.setAttribute('x1', p.lL[0]); legL.setAttribute('y1', p.lL[1]); legL.setAttribute('x2', p.lL[2]); legL.setAttribute('y2', p.lL[3]);
        legR.setAttribute('x1', p.lR[0]); legR.setAttribute('y1', p.lR[1]); legR.setAttribute('x2', p.lR[2]); legR.setAttribute('y2', p.lR[3]);
        shadow.style.transform = `translateX(-50%) scale(${p.sh})`;
      }

      function nextPose(){
        from = to; i = (i+1)%poses.length; to = poses[i]; start = null; requestAnimationFrame(step);
      }

      function step(ts){
        if(!start) start = ts;
        const dur = to.t;
        const t = Math.min(1, (ts-start)/dur);
        const e = easeInOut(t);
        const p = {
          h: mix2(from.h, to.h, e),
          s: mix4(from.s, to.s, e),
          aL: mix4(from.aL, to.aL, e),
          aR: mix4(from.aR, to.aR, e),
          lL: mix4(from.lL, to.lL, e),
          lR: mix4(from.lR, to.lR, e),
          sh: lerp(from.sh, to.sh, e)
        };
        apply(p);
        if(t<1){ requestAnimationFrame(step); } else { setTimeout(nextPose, 60); }
      }

      // start
      apply(from);
      requestAnimationFrame(step);
    }

    // ---------- Init ----------
    function init(){
      $('#dateInput').value = fmtYMD(new Date());
      $('#countInput').value = entries.find(e=>e.date===fmtYMD(new Date()))?.count ?? '';
      updateExistingHint();
      renderAll();

      // Events
      $('#dateInput').addEventListener('change', updateExistingHint);
      $('#saveBtn').addEventListener('click', onSave);
      $('#prevMonth').addEventListener('click', ()=>{ monthDate.setMonth(monthDate.getMonth()-1); renderCalendar(); });
      $('#nextMonth').addEventListener('click', ()=>{ monthDate.setMonth(monthDate.getMonth()+1); renderCalendar(); });
      document.querySelectorAll('[data-qa]').forEach(btn=> btn.addEventListener('click', ()=> quickAdd(+btn.dataset.qa)) );
      $('#exportBtn').addEventListener('click', exportJSON);
      $('#importFile').addEventListener('change', onImportFile);
      $('#clearBtn').addEventListener('click', clearAll);

      animateBurpee();
    }

    init();
  </script>
</body>
</html>
