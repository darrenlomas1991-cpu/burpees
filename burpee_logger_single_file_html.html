<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Burpee Logger</title>
  <style>
    :root{
      --bg:#f7f8fb;--panel:#fff;--muted:#6b7280;--text:#0f172a;--primary:#2563eb;--ring:#3b82f6;--danger:#ef4444;--ok:#16a34a;
      --green100:#dcfce7;--green200:#bbf7d0;--green300:#86efac;--green400:#4ade80;--gray100:#f3f4f6;
    }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(#f7f8fb,#fff);color:var(--text);font:14px/1.4 system-ui,Segoe UI,Inter,Roboto,Arial}
    .container{max-width:1100px;margin:auto;padding:24px}
    h1{font-size:28px;margin:0 0 6px;font-weight:700}
    p.sub{color:var(--muted);margin:0 0 20px}
    .row{display:grid;gap:16px}
    .row.cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}
    .row.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .row.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:820px){.row.cols-5{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:700px){.row.cols-3{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.04)}
    .card .content{padding:16px}
    .btn{appearance:none;border:1px solid #d1d5db;background:#fff;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer;transition:.15s}
    .btn:hover{box-shadow:0 2px 8px rgba(0,0,0,.05)}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.ghost{background:transparent;border:none;color:var(--text)}
    .btn.danger{background:var(--danger);border-color:var(--danger);color:#fff}
    .btn.small{padding:4px 8px;border-radius:8px}
    .btn-group{display:flex;gap:8px;flex-wrap:wrap}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input[type="date"],input[type="number"],input[type="file"]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;font:inherit}
    input:focus{outline:2px solid var(--ring);outline-offset:1px}
    .stat{display:flex;flex-direction:column;gap:4px}
    .stat .val{font-size:22px;font-weight:700}
    .stat .lbl{font-size:11px;color:var(--muted)}
    .header{display:flex;flex-wrap:wrap;gap:10px;align-items:end;justify-content:space-between;margin-bottom:16px}
    .muted{color:var(--muted)}

    /* Calendar */
    .cal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .cal-wd{font-size:11px;color:var(--muted);text-align:center}
    .cal-cell{border-radius:10px;padding:6px;display:flex;flex-direction:column;gap:4px;align-items:center;justify-content:center;border:1px solid #e5e7eb;background:#fff;transition:.12s}
    .cal-cell.dim{opacity:.45}
    .cal-cell:hover{outline:2px solid var(--ring)}
    .heat{height:30px;width:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;border:1px solid #e5e7eb}
    .heat.level0{background:var(--gray100)}
    .heat.level1{background:var(--green100)}
    .heat.level2{background:var(--green200)}
    .heat.level3{background:var(--green300)}
    .heat.level4{background:var(--green400)}
    .cal-day{font-size:10px;font-weight:600}

    /* Tabs */
    .tabs{display:flex;gap:6px;margin:0 0 8px}
    .tabs button{padding:6px 10px;border-radius:10px;border:1px solid #d1d5db;background:#fff}
    .tabs button.active{background:var(--text);color:#fff;border-color:var(--text)}

    /* Chart */
    .chart-wrap{height:260px}
    svg.chart{width:100%;height:100%;display:block}
    .axis text{font-size:10px;fill:#475569}
    .bar{shape-rendering:crispEdges}
    .tooltip{position:fixed;pointer-events:none;background:#111827;color:#fff;padding:6px 8px;border-radius:8px;font-size:12px;opacity:0;transform:translate(-50%,-120%);transition:opacity .1s}

    .footer{font-size:12px;color:var(--muted);text-align:center;padding-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>Burpee Logger</h1>
        <p class="sub">Log a single <b>daily total</b>, track streaks, and view weekly / monthly / yearly progress. Data stays in your browser.</p>
      </div>
      <div class="btn-group">
        <button id="exportBtn" class="btn">Export</button>
        <label class="btn" for="importFile">Import JSON</label>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
        <button id="clearBtn" class="btn danger">Clear</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="row cols-5">
      <div class="card"><div class="content stat"><div class="val" id="todayVal">0</div><div class="lbl">Today</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="weekVal">0</div><div class="lbl">This Week</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="monthVal">0</div><div class="lbl">This Month</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="yearVal">0</div><div class="lbl">This Year</div></div></div>
      <div class="card"><div class="content stat"><div class="val" id="streakVal">0</div><div class="lbl">Streak (days)</div></div></div>
    </div>

    <!-- Entry form -->
    <div class="card" style="margin-top:16px">
      <div class="content">
        <div class="row cols-3" style="align-items:end">
          <div>
            <label for="dateInput">Date</label>
            <input id="dateInput" type="date" />
          </div>
          <div>
            <label for="countInput">Total burpees (for that day)</label>
            <input id="countInput" type="number" min="0" placeholder="e.g., 100" />
            <div class="muted" id="existingForDate" style="font-size:11px;margin-top:4px"></div>
          </div>
          <div>
            <button id="saveBtn" class="btn primary" style="width:100%">Save Daily Total</button>
          </div>
        </div>
        <div class="btn-group" style="margin-top:10px">
          <span class="muted">Quick add to <b>today</b>:</span>
          <button class="btn small" data-qa="10">+10</button>
          <button class="btn small" data-qa="25">+25</button>
          <button class="btn small" data-qa="50">+50</button>
          <button class="btn small" data-qa="100">+100</button>
        </div>
      </div>
    </div>

    <!-- Calendar & Charts -->
    <div class="row cols-2" style="margin-top:16px">
      <div class="card">
        <div class="content">
          <div class="cal-head">
            <button id="prevMonth" class="btn ghost" title="Previous month">◀</button>
            <div><b id="monthTitle">Month YYYY</b></div>
            <button id="nextMonth" class="btn ghost" title="Next month">▶</button>
          </div>
          <div class="cal-grid" id="calGrid">
            <!-- weekdays -->
          </div>
        </div>
      </div>

      <div class="card">
        <div class="content">
          <div class="tabs">
            <button class="tabBtn active" data-tab="weekly">Weekly</button>
            <button class="tabBtn" data-tab="monthly">Monthly</button>
            <button class="tabBtn" data-tab="yearly">Yearly</button>
          </div>
          <div class="chart-wrap">
            <svg class="chart" id="chart" viewBox="0 0 800 260" preserveAspectRatio="none"></svg>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">Tip: Click any day in the calendar to edit that date. Your data is stored in Local Storage.</div>
  </div>

  <div id="tt" class="tooltip"></div>

  <script>
    // ---------- Utilities ----------
    const LS_KEY = 'burpeesLog.v1';
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const fmtYMD = d => {
      if (typeof d === 'string') return d;
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    };
    const parseYMD = s => { const [y,m,d]=s.split('-').map(Number); return new Date(y, m-1, d); };
    const addDays = (date,n)=>{ const d=new Date(date); d.setDate(d.getDate()+n); return d; };
    const startOfMonth = d=>{ const x=new Date(d.getFullYear(), d.getMonth(), 1); x.setHours(0,0,0,0); return x; };
    const endOfMonth = d=>{ const x=new Date(d.getFullYear(), d.getMonth()+1, 0); x.setHours(0,0,0,0); return x; };
    const startOfWeek = date=>{ const d=new Date(date); const day=(d.getDay()+6)%7; d.setDate(d.getDate()-day); d.setHours(0,0,0,0); return d; };// Mon
    function getISOWeekYear(date){
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      d.setUTCDate(d.getUTCDate()+4-(d.getUTCDay()||7));
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
      const week = Math.ceil(((d - yearStart)/86400000 + 1)/7);
      return {week, year: d.getUTCFullYear()};
    }

    // ---------- Storage ----------
    function loadEntries(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return [];
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr)) return [];
        return arr.filter(e=>e && typeof e.date==='string' && Number.isFinite(e.count));
      }catch(e){console.error(e); return []}
    }
    function saveEntries(entries){ localStorage.setItem(LS_KEY, JSON.stringify(entries)); }

    // ---------- State ----------
    let entries = loadEntries(); // [{date:'YYYY-MM-DD', count:Number}]
    let monthDate = new Date();

    // ---------- DOM Init ----------
    function init(){
      $('#dateInput').value = fmtYMD(new Date());
      $('#countInput').value = entries.find(e=>e.date===fmtYMD(new Date()))?.count ?? '';
      updateExistingHint();
      renderAll();

      // Events
      $('#dateInput').addEventListener('change', updateExistingHint);
      $('#countInput').addEventListener('input', ()=>{});
      $('#saveBtn').addEventListener('click', onSave);
      $$('#calGrid').forEach(()=>{});
      $$('#prevMonth, #nextMonth').forEach(()=>{});
      $('#prevMonth').addEventListener('click', ()=>{ monthDate.setMonth(monthDate.getMonth()-1); renderCalendar(); });
      $('#nextMonth').addEventListener('click', ()=>{ monthDate.setMonth(monthDate.getMonth()+1); renderCalendar(); });

      $$('# .btn[data-qa]');
      $$('[data-qa]').forEach(btn=> btn.addEventListener('click', ()=> quickAdd(+btn.dataset.qa)) );

      $('#exportBtn').addEventListener('click', exportJSON);
      $('#importFile').addEventListener('change', onImportFile);
      $('#clearBtn').addEventListener('click', clearAll);

      $$('.tabBtn').forEach(b=> b.addEventListener('click', ()=>{ $$('.tabBtn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); renderChart(b.dataset.tab); }));
    }

    function updateExistingHint(){
      const key = $('#dateInput').value;
      const existing = entries.find(e=>e.date===key)?.count || 0;
      const el = $('#existingForDate');
      el.textContent = existing>0 ? `Existing total for this date: ${existing}` : '';
    }

    function upsertEntry(dateKey, total){
      entries = entries.filter(e=>e.date!==dateKey).concat({date:dateKey, count:total}).sort((a,b)=>a.date.localeCompare(b.date));
      saveEntries(entries);
      renderAll();
    }

    function onSave(){
      const dateKey = $('#dateInput').value || fmtYMD(new Date());
      const total = Number($('#countInput').value||0);
      const existing = entries.find(e=>e.date===dateKey)?.count;
      if(existing!=null && existing!==total){
        if(!confirm(`Overwrite existing total of ${existing} for ${dateKey} with ${total}?`)) return;
      }
      upsertEntry(dateKey,total);
    }

    function quickAdd(n){
      const todayKey = fmtYMD(new Date());
      const current = entries.find(e=>e.date===todayKey)?.count || 0;
      const newTotal = current + n;
      upsertEntry(todayKey,newTotal);
      $('#dateInput').value = todayKey; $('#countInput').value = newTotal; updateExistingHint();
    }

    // ---------- Aggregates ----------
    function aggregates(){
      const byDate = new Map();
      let totalAll = 0;
      for(const e of entries){ byDate.set(e.date, (byDate.get(e.date)||0)+e.count); totalAll+=e.count; }
      const now = new Date();
      const todayKey = fmtYMD(now);
      const weekStart = startOfWeek(now);
      const monthStart = startOfMonth(now);
      const yearStart = new Date(now.getFullYear(),0,1);
      let today=0,thisWeek=0,thisMonth=0,thisYear=0;
      for(const [d,c] of byDate){
        const dt = parseYMD(d);
        if(d===todayKey) today+=c;
        if(dt>=weekStart) thisWeek+=c;
        if(dt>=monthStart) thisMonth+=c;
        if(dt>=yearStart) thisYear+=c;
      }
      // streak ending today
      let streak=0; for(let i=0;i<9999;i++){ const key=fmtYMD(addDays(now,-i)); const c=byDate.get(key)||0; if(c>0) streak++; else break; }

      // weekly
      const wmap=new Map();
      for(const e of entries){ const {week,year}=getISOWeekYear(parseYMD(e.date)); const k=`${year}-W${String(week).padStart(2,'0')}`; wmap.set(k,(wmap.get(k)||0)+e.count); }
      const weekly=[...wmap.entries()].sort().map(([k,v])=>({period:k,total:v}));
      // monthly
      const mmap=new Map();
      for(const e of entries){ const d=parseYMD(e.date); const k=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; mmap.set(k,(mmap.get(k)||0)+e.count); }
      const monthly=[...mmap.entries()].sort().map(([k,v])=>({period:k,total:v}));
      // yearly
      const ymap=new Map();
      for(const e of entries){ const y=parseYMD(e.date).getFullYear(); ymap.set(y,(ymap.get(y)||0)+e.count); }
      const yearly=[...ymap.entries()].sort().map(([k,v])=>({period:String(k),total:v}));

      return {today,thisWeek,thisMonth,thisYear,streak,byDate,weekly,monthly,yearly};
    }

    // ---------- Calendar ----------
    function heatLevel(val){
      if(!val) return 0; const t = Math.min(val,200)/200; if(t<=0.25) return 1; if(t<=0.5) return 2; if(t<=0.75) return 3; return 4;
    }
    function renderCalendar(){
      const {byDate} = aggregates();
      $('#monthTitle').textContent = monthDate.toLocaleString(undefined,{month:'long',year:'numeric'});
      const first = startOfMonth(monthDate), last=endOfMonth(monthDate); const gridStart=startOfWeek(first);
      const grid = $('#calGrid'); grid.innerHTML='';
      ;['Mon','Tue','Wed','Thu','Fri','Sat','Sun'].forEach(d=>{
        const wd = document.createElement('div'); wd.className='cal-wd'; wd.textContent=d; grid.appendChild(wd);
      });
      let c=new Date(gridStart); const cells=[];
      while(c<=last || (cells.length%7)!==0){
        const key=fmtYMD(c); const count=byDate.get(key)||0; const el=document.createElement('button'); el.className='cal-cell'+(c.getMonth()!==monthDate.getMonth()?' dim':''); el.title=`${key}: ${count} burpees`;
        el.addEventListener('click',()=>{ $('#dateInput').value=key; $('#countInput').value=count||''; updateExistingHint(); window.scrollTo({top:0,behavior:'smooth'}); });
        const heat=document.createElement('div'); heat.className='heat level'+heatLevel(count); heat.textContent=count?String(count):''; el.appendChild(heat);
        const day=document.createElement('div'); day.className='cal-day'; day.textContent=String(c.getDate()); el.appendChild(day);
        grid.appendChild(el); cells.push(el); c=addDays(c,1);
      }
    }

    // ---------- Charts (SVG) ----------
    function renderChart(kind){
      const svg = $('#chart');
      const {weekly,monthly,yearly} = aggregates();
      const data = kind==='monthly'?monthly : kind==='yearly'?yearly : weekly;
      // clear
      while(svg.firstChild) svg.removeChild(svg.firstChild);
      const W=800,H=260, padL=42, padB=28, padT=10, padR=10; const innerW=W-padL-padR, innerH=H-padT-padB;
      const max = Math.max(1, ...data.map(d=>d.total));
      const barW = Math.max(6, innerW / Math.max(1,data.length) - 4);

      // axes labels (x)
      const xg = document.createElementNS('http://www.w3.org/2000/svg','g'); xg.setAttribute('class','axis'); svg.appendChild(xg);
      data.forEach((d,i)=>{
        const x = padL + i*(innerW/data.length) + barW/2;
        const t = document.createElementNS(svg.namespaceURI,'text');
        t.setAttribute('x', x); t.setAttribute('y', H-8); t.setAttribute('text-anchor','middle'); t.textContent = d.period; xg.appendChild(t);
      });
      // y axis ticks 0..max (4 ticks)
      const yg = document.createElementNS(svg.namespaceURI,'g'); yg.setAttribute('class','axis'); svg.appendChild(yg);
      for(let i=0;i<=4;i++){
        const v = Math.round(max*i/4);
        const y = padT + innerH - (v/max)*innerH;
        const t = document.createElementNS(svg.namespaceURI,'text'); t.setAttribute('x', 4); t.setAttribute('y', y+4); t.textContent = v; yg.appendChild(t);
        const line = document.createElementNS(svg.namespaceURI,'line'); line.setAttribute('x1', padL); line.setAttribute('x2', W-padR); line.setAttribute('y1', y); line.setAttribute('y2', y); line.setAttribute('stroke', '#e5e7eb'); svg.appendChild(line);
      }
      // bars
      const g = document.createElementNS(svg.namespaceURI,'g'); svg.appendChild(g);
      data.forEach((d,i)=>{
        const x = padL + i*(innerW/data.length) + 2;
        const h = (d.total/max)*innerH;
        const y = padT + innerH - h;
        const r = document.createElementNS(svg.namespaceURI,'rect');
        r.setAttribute('x', x); r.setAttribute('y', y); r.setAttribute('width', barW); r.setAttribute('height', h);
        r.setAttribute('fill', '#60a5fa'); r.setAttribute('class','bar');
        r.addEventListener('mousemove', ev=> showTip(`${d.period}: ${d.total} burpees`, ev.pageX, ev.pageY));
        r.addEventListener('mouseleave', hideTip);
        g.appendChild(r);
      });
    }

    function showTip(text,x,y){ const tt=$('#tt'); tt.textContent=text; tt.style.left=x+'px'; tt.style.top=y+'px'; tt.style.opacity=1; }
    function hideTip(){ const tt=$('#tt'); tt.style.opacity=0; }

    // ---------- Export / Import / Clear ----------
    function exportJSON(){
      const blob = new Blob([JSON.stringify(entries,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download = `burpees-log-${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
    }
    function onImportFile(e){
      const f=e.target.files?.[0]; if(!f) return; const reader=new FileReader(); reader.onload=()=>{
        try{
          const parsed = JSON.parse(reader.result);
          if(Array.isArray(parsed)){
            const cleaned = parsed
              .filter(x=>x && typeof x.date==='string' && Number.isFinite(x.count))
              .map(x=>({date:fmtYMD(parseYMD(x.date)), count:Number(x.count)}))
              .sort((a,b)=>a.date.localeCompare(b.date));
            entries = cleaned; saveEntries(entries); renderAll();
          }
        }catch(err){ alert('Import failed: '+err); }
      }; reader.readAsText(f);
      e.target.value='';
    }
    function clearAll(){ if(confirm('This will delete all logged burpees. Continue?')){ entries=[]; saveEntries(entries); renderAll(); } }

    // ---------- Render ----------
    function renderStats(){ const a=aggregates(); $('#todayVal').textContent=a.today; $('#weekVal').textContent=a.thisWeek; $('#monthVal').textContent=a.thisMonth; $('#yearVal').textContent=a.thisYear; $('#streakVal').textContent=a.streak; }
    function renderAll(){ renderStats(); renderCalendar(); const active=$('.tabBtn.active')?.dataset.tab || 'weekly'; renderChart(active); }

    // boot
    init();
  </script>
</body>
</html>
